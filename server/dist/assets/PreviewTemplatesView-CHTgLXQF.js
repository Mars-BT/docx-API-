import{d as Q,r as u,u as Y,o as Z,b as f,e as a,f as o,z as U,F as B,i as V,w as s,l as A,A as ee,h as d,t as _,k as c,B as te,x as le,m as ae,E as r,a as oe,j as p,y as se,_ as ne}from"./index-DgJpEOly.js";import{c as ie,d as re,e as ue,u as de,f as me}from"./api-BUDIlLK6.js";const ce={class:"preview-templates-view"},pe={class:"main-container"},ve={class:"category-container"},fe=["onClick"],_e={class:"category-count"},ge={class:"upload-button-container"},Ce={class:"templates-container"},ye={class:"template-icon"},we=["title"],ke={class:"file-info"},he={class:"file-category"},Ne={class:"file-time"},be={class:"buttons"},Fe={class:"dialog-footer"},xe=Q({__name:"PreviewTemplatesView",setup(Be){const y=u([]),m=u("all"),h=u([]),g=u(!1),w=u(!1),v=u(),$=u(),i=u({templateName:"",templateCategory:"",file:null}),P={templateName:[{required:!0,message:"请输入模板名称",trigger:"blur"},{min:1,max:50,message:"模板名称长度在1到50个字符",trigger:"blur"}],templateCategory:[{required:!0,message:"请选择或输入模板分类",trigger:"change"}],file:[{required:!0,message:"请选择要上传的文件",trigger:"change"}]},C=Y(),T=oe(),D=t=>{m.value=t,t==="all"?k():b(t)},N=async()=>{const t=await ie();y.value=t,console.log(y.value)},k=async()=>{const t=await re();console.log("所有文件:",t),h.value=t},b=async t=>{const e=await ue(t);console.log("分类文件:",e),h.value=e},R=t=>new Date(t).toLocaleDateString("zh-CN"),L=t=>{C.setTemplateId(t.id),console.log("storage.templateId:",C.templateId),C.setNavigationButton("templates-settings"),T.push({name:"templates-settings"}),r.success(`已选择模板：${t.templateName}`)},M=t=>{C.setTemplateId(t.id),console.log("API接口:",t),C.setNavigationButton("templates-test"),T.push({name:"templates-test"}),r.success(`已选择测试模板：${t.templateName}`)},S=async t=>{try{await se.confirm(`确定要删除模板"${t.templateName}"吗？此操作将删除模板文件、配置规则和相关数据，且无法恢复。`,"确认删除",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}),await me(t.id),r.success(`模板"${t.templateName}"已成功删除`),m.value==="all"?k():b(m.value),N()}catch(e){e!=="cancel"&&(console.error("删除文件失败:",e),r.error(e.message||"删除文件失败"))}},z=(t,e)=>{var n;t.raw&&(i.value.file=t.raw,(n=v.value)==null||n.validateField("file"))},E=(t,e)=>{var n;i.value.file=null,(n=v.value)==null||n.validateField("file")},q=t=>{const e=t.type==="application/vnd.openxmlformats-officedocument.wordprocessingml.document"||t.name.toLowerCase().endsWith(".docx"),n=t.size/1024/1024<100;return e?n?!0:(r.error("上传文件大小不能超过100MB!"),!1):(r.error("只能上传DOCX格式的文件!"),!1)},O=()=>{g.value=!1,I()},X=async()=>{if(v.value)try{if(await v.value.validate(),!i.value.file){r.error("请选择要上传的文件");return}w.value=!0;const t=await de(i.value.file,i.value.templateName,i.value.templateCategory);r.success("文件上传成功！"),g.value=!1,I(),await Promise.all([m.value==="all"?k():b(m.value),N()])}catch(t){console.error("文件上传失败:",t),r.error(t.message||"文件上传失败")}finally{w.value=!1}},I=()=>{var t,e;i.value={templateName:"",templateCategory:"",file:null},(t=$.value)==null||t.clearFiles(),(e=v.value)==null||e.resetFields()};return Z(()=>{k(),N()}),(t,e)=>{const n=d("el-button"),G=d("el-input"),F=d("el-form-item"),j=d("el-option"),W=d("el-select"),H=d("el-upload"),J=d("el-form"),K=d("el-dialog");return p(),f("div",ce,[a("div",pe,[a("div",ve,[a("div",{class:U(["category-item",{active:m.value==="all"}]),onClick:e[0]||(e[0]=l=>D("all"))},e[5]||(e[5]=[a("span",null,"全部",-1)]),2),(p(!0),f(B,null,V(y.value,l=>(p(),f("div",{class:U(["category-item",{active:m.value===l.name}]),key:l.name,onClick:x=>D(l.name)},[a("span",null,_(l.name),1),a("span",_e,_(l.count),1)],10,fe))),128)),a("div",ge,[o(n,{type:"primary",icon:A(ee),onClick:e[1]||(e[1]=l=>g.value=!0)},{default:s(()=>e[6]||(e[6]=[c(" 上传模板 ")])),_:1,__:[6]},8,["icon"])])]),a("div",Ce,[(p(!0),f(B,null,V(h.value,l=>(p(),f("div",{class:"template-item",key:l.id},[a("div",ye,[o(te,{width:40,height:40,color:"#764ba2"}),a("div",{class:"file-name",title:l.templateName},_(l.templateName),9,we)]),a("div",ke,[a("div",he,_(l.templateCategory),1),a("div",Ne,_(R(l.uploadTime)),1)]),a("div",be,[o(n,{type:"primary",onClick:x=>L(l)},{default:s(()=>e[7]||(e[7]=[c("设置模板")])),_:2,__:[7]},1032,["onClick"]),o(n,{type:"warning",onClick:x=>M(l)},{default:s(()=>e[8]||(e[8]=[c("API接口")])),_:2,__:[8]},1032,["onClick"]),o(n,{type:"danger",onClick:x=>S(l)},{default:s(()=>e[9]||(e[9]=[c("删除")])),_:2,__:[9]},1032,["onClick"])])]))),128))])]),o(K,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=l=>g.value=l),title:"上传模板文件",width:"500px","close-on-click-modal":!1},{footer:s(()=>[a("div",Fe,[o(n,{onClick:O},{default:s(()=>e[12]||(e[12]=[c("取消")])),_:1,__:[12]}),o(n,{type:"primary",onClick:X,loading:w.value},{default:s(()=>[c(_(w.value?"上传中...":"确定上传"),1)]),_:1},8,["loading"])])]),default:s(()=>[o(J,{model:i.value,rules:P,ref_key:"uploadFormRef",ref:v,"label-width":"100px"},{default:s(()=>[o(F,{label:"模板名称",prop:"templateName"},{default:s(()=>[o(G,{modelValue:i.value.templateName,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.templateName=l),placeholder:"请输入模板名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(F,{label:"模板分类",prop:"templateCategory"},{default:s(()=>[o(W,{modelValue:i.value.templateCategory,"onUpdate:modelValue":e[3]||(e[3]=l=>i.value.templateCategory=l),placeholder:"请选择或输入分类",filterable:"","allow-create":"",style:{width:"100%"}},{default:s(()=>[(p(!0),f(B,null,V(y.value,l=>(p(),le(j,{key:l.name,label:l.name,value:l.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(F,{label:"选择文件",prop:"file"},{default:s(()=>[o(H,{ref_key:"uploadRef",ref:$,"auto-upload":!1,"show-file-list":!0,limit:1,accept:".docx","on-change":z,"on-remove":E,"before-upload":q},{tip:s(()=>e[11]||(e[11]=[a("div",{class:"el-upload__tip"}," 只能上传DOCX文件，且不超过100MB ",-1)])),default:s(()=>[o(n,{type:"primary",icon:A(ae)},{default:s(()=>e[10]||(e[10]=[c("选择DOCX文件")])),_:1,__:[10]},8,["icon"])]),_:1},512)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Te=ne(xe,[["__scopeId","data-v-5caaa60e"]]);export{Te as default};
