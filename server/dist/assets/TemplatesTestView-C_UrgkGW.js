import{d as q,u as z,r as y,o as Y,E as r,a as Z,c as G,b as i,e,f as s,g as h,t as c,w as n,h as m,F as H,i as K,j as d,k as v,l as T,m as j,n as Q,v as X,_ as ee}from"./index-DgJpEOly.js";import{g as te,a as le,b as se}from"./api-BUDIlLK6.js";const ae={class:"templates-test-view"},ne={class:"main-container"},oe={class:"template-header"},ie={class:"template-info"},de={key:0,class:"template-details"},ue={class:"detail-item"},re={class:"value"},pe={class:"detail-item"},ce={class:"value"},me={class:"header-actions"},ve={class:"form-section"},_e={key:0,class:"data-rules-form"},ye={class:"rule-info"},fe={class:"rule-header"},ge={class:"rule-name"},he={class:"rule-description"},be={class:"rule-input"},xe={key:0,class:"input-group"},Te={class:"input-label"},ke={key:1,class:"input-group"},Ve={key:1,class:"empty-rules"},we={key:0,class:"output-section"},Ie={class:"output-config"},Ce={key:1,class:"footer-actions"},Ne={class:"api-doc"},Re={class:"api-section"},je={class:"code-block"},Pe={class:"dialog-footer"},Se=q({__name:"TemplatesTestView",setup(De){const _=z(),I=Z(),p=y(),u=y([]),b=y([]),f=y(""),k=y(!1),x=y(!1);Y(()=>{if(!_.templateId){r.warning("请先选择模板"),I.push({name:"preview-templates"});return}P(),S()});const P=async()=>{try{const l=await te(_.templateId);p.value=l}catch(l){r.error("获取模板信息失败"),console.error(l)}},S=async()=>{try{const l=await le(_.templateId);u.value=l.rules||[],b.value=u.value.map(t=>({varname:t.varname,type:t.type,path:"",value:""})),p.value&&(f.value=`./generated_${p.value.templateName.replace(/\s+/g,"_")}_${Date.now()}`)}catch(l){r.error("获取模板规则失败"),console.error(l)}},D=l=>({excel:"Excel",json:"JSON",direct:"直接赋值"})[l]||l,E=l=>({excel:"success",json:"warning",direct:"info"})[l]||"",M=l=>({original:"原始值",formatToChineseNumber:"转千位符",formatToWanYuan:"转成万元",formatToFixed2:"保留2位小数"})[l]||l,A=l=>u.value.find(t=>t.varname===l),C=G(()=>f.value?b.value.every(l=>l.type==="excel"||l.type==="json"?l.path&&l.path.trim()!=="":l.type==="direct"?l.value&&l.value.trim()!=="":!1):!1),B=()=>{_.setNavigationButton("templates-settings"),I.push({name:"templates-settings"})},F=async()=>{if(!C.value){r.warning("请填写完整的配置信息");return}k.value=!0;try{const l={fileId:_.templateId,outputPath:f.value+".docx",dataRules:b.value.map(o=>({varname:o.varname,type:o.type,...o.type==="direct"?{value:o.value}:{path:o.path}}))},t=await se(l);r.success(`文档生成成功！输出路径：${t.outputPath}`),console.log("构建结果:",t)}catch(l){r.error("生成失败："+l.message),console.error(l)}finally{k.value=!1}},N=()=>{if(!p.value||u.value.length===0)return"// 请先加载模板规则";const l={fileId:_.templateId,outputPath:"./generated_document.docx",dataRules:u.value.map(t=>t.type==="excel"?{varname:t.varname,type:t.type,path:"C:/path/to/your/excel/file.xlsx"}:t.type==="json"?{varname:t.varname,type:t.type,path:"C:/path/to/your/json/file.json"}:t.type==="direct"?{varname:t.varname,type:t.type,value:"这是直接赋值的内容"}:{varname:t.varname,type:t.type})};return JSON.stringify(l,null,2)},O=async()=>{try{const l=N();await navigator.clipboard.writeText(l),r.success("示例代码已复制到剪贴板")}catch(l){r.error("复制失败，请手动复制"),console.error(l)}};return(l,t)=>{const o=m("el-icon"),g=m("el-button"),U=m("el-tag"),V=m("el-input"),$=m("el-empty"),J=m("el-form-item"),W=m("el-dialog");return d(),i("div",ae,[e("div",ne,[e("div",oe,[e("div",ie,[t[6]||(t[6]=e("h1",{class:"title"},"模板测试",-1)),p.value?(d(),i("div",de,[e("div",ue,[t[4]||(t[4]=e("span",{class:"label"},"模板名称：",-1)),e("span",re,c(p.value.templateName),1)]),e("div",pe,[t[5]||(t[5]=e("span",{class:"label"},"模板分类：",-1)),e("span",ce,c(p.value.templateCategory),1)])])):h("",!0)]),e("div",me,[s(g,{type:"warning",onClick:t[0]||(t[0]=a=>x.value=!0)},{default:n(()=>[s(o,null,{default:n(()=>[s(T(j))]),_:1}),t[7]||(t[7]=v(" 查看API说明 "))]),_:1,__:[7]})])]),e("div",ve,[t[10]||(t[10]=e("div",{class:"section-header"},[e("h2",null,"数据加载规则配置"),e("div",{class:"section-description"}," 根据模板规则填写数据源路径，用于生成最终文档 ")],-1)),u.value.length>0?(d(),i("div",_e,[(d(!0),i(H,null,K(b.value,(a,L)=>{var R;return d(),i("div",{class:"rule-form-item",key:L},[e("div",ye,[e("div",fe,[s(U,{type:E(a.type)},{default:n(()=>[v(c(D(a.type)),1)]),_:2},1032,["type"]),e("span",ge,c(a.varname),1)]),e("div",he," 格式化方法："+c(M(((R=A(a.varname))==null?void 0:R.format)||"original")),1)]),e("div",be,[a.type==="excel"||a.type==="json"?(d(),i("div",xe,[e("label",Te,c(a.type==="excel"?"Excel文件路径":"JSON文件路径"),1),s(V,{modelValue:a.path,"onUpdate:modelValue":w=>a.path=w,placeholder:a.type==="excel"?"请输入Excel文件的完整路径":"请输入JSON文件的完整路径",clearable:""},{prepend:n(()=>[s(o,null,{default:n(()=>[s(T(j))]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])):h("",!0),a.type==="direct"?(d(),i("div",ke,[t[8]||(t[8]=e("label",{class:"input-label"},"直接赋值",-1)),s(V,{modelValue:a.value,"onUpdate:modelValue":w=>a.value=w,placeholder:"请输入要赋值的内容",type:"textarea",rows:2,clearable:""},null,8,["modelValue","onUpdate:modelValue"])])):h("",!0)])])}),128))])):(d(),i("div",Ve,[s($,{description:"未找到模板规则，请先设置模板规则"},{default:n(()=>[s(g,{type:"primary",onClick:B},{default:n(()=>t[9]||(t[9]=[v("去设置规则")])),_:1,__:[9]})]),_:1})]))]),u.value.length>0?(d(),i("div",we,[t[12]||(t[12]=e("div",{class:"section-header"},[e("h3",null,"输出设置")],-1)),e("div",Ie,[s(J,{label:"输出文件路径"},{default:n(()=>[s(V,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=a=>f.value=a),placeholder:"请输入生成文档的保存路径",clearable:""},{prepend:n(()=>[s(o,null,{default:n(()=>[s(T(Q))]),_:1})]),append:n(()=>t[11]||(t[11]=[v(".docx")])),_:1},8,["modelValue"])]),_:1})])])):h("",!0),u.value.length>0?(d(),i("div",Ce,[s(g,{type:"success",size:"large",onClick:F,loading:k.value,disabled:!C.value},{default:n(()=>[s(o,null,{default:n(()=>[s(T(X))]),_:1}),t[13]||(t[13]=v(" 开始测试生成 "))]),_:1,__:[13]},8,["loading","disabled"])])):h("",!0)]),s(W,{modelValue:x.value,"onUpdate:modelValue":t[3]||(t[3]=a=>x.value=a),title:"API接口说明文档",width:"800px","close-on-click-modal":!1},{footer:n(()=>[e("span",Pe,[s(g,{onClick:t[2]||(t[2]=a=>x.value=!1)},{default:n(()=>t[21]||(t[21]=[v("关闭")])),_:1,__:[21]}),s(g,{type:"primary",onClick:O},{default:n(()=>t[22]||(t[22]=[v("复制示例代码")])),_:1,__:[22]})])]),default:n(()=>[e("div",Ne,[t[15]||(t[15]=e("div",{class:"api-section"},[e("h3",{class:"section-title"},"接口概述"),e("p",{class:"section-desc"}," 使用此API可以通过POST请求生成Word文档。您需要提供模板文件ID、数据规则和输出路径。 ")],-1)),t[16]||(t[16]=e("div",{class:"api-section"},[e("h3",{class:"section-title"},"请求地址"),e("div",{class:"code-block"},[e("code",null,"POST http://localhost:3000/api/templates/build")])],-1)),t[17]||(t[17]=e("div",{class:"api-section"},[e("h3",{class:"section-title"},"请求头"),e("div",{class:"code-block"},[e("code",null,"Content-Type: application/json")])],-1)),t[18]||(t[18]=e("div",{class:"api-section"},[e("h3",{class:"section-title"},"请求参数"),e("div",{class:"param-table"},[e("table",null,[e("thead",null,[e("tr",null,[e("th",null,"参数名"),e("th",null,"类型"),e("th",null,"必填"),e("th",null,"说明")])]),e("tbody",null,[e("tr",null,[e("td",null,"fileId"),e("td",null,"string"),e("td",null,"是"),e("td",null,"模板文件ID")]),e("tr",null,[e("td",null,"outputPath"),e("td",null,"string"),e("td",null,"是"),e("td",null,"生成文档的保存路径")]),e("tr",null,[e("td",null,"dataRules"),e("td",null,"array"),e("td",null,"是"),e("td",null,"数据加载规则数组")])])])])],-1)),t[19]||(t[19]=e("div",{class:"api-section"},[e("h3",{class:"section-title"},"数据规则说明 (dataRules)"),e("p",{class:"section-desc"}," dataRules数组中的每个对象包含以下字段： "),e("div",{class:"param-table"},[e("table",null,[e("thead",null,[e("tr",null,[e("th",null,"字段名"),e("th",null,"类型"),e("th",null,"必填"),e("th",null,"说明")])]),e("tbody",null,[e("tr",null,[e("td",null,"varname"),e("td",null,"string"),e("td",null,"是"),e("td",null,"变量名（由模板规则决定）")]),e("tr",null,[e("td",null,"type"),e("td",null,"string"),e("td",null,"是"),e("td",null,"数据类型：excel、json、direct")]),e("tr",null,[e("td",null,"path"),e("td",null,"string"),e("td",null,"条件"),e("td",null,"当type为excel或json时必填，文件路径")]),e("tr",null,[e("td",null,"value"),e("td",null,"string"),e("td",null,"条件"),e("td",null,"当type为direct时必填，直接赋值内容")])])])])],-1)),e("div",Re,[t[14]||(t[14]=e("h3",{class:"section-title"},"当前模板示例",-1)),e("div",je,[e("pre",null,c(N()),1)])]),t[20]||(t[20]=e("div",{class:"api-section"},[e("h3",{class:"section-title"},"响应结果"),e("div",{class:"code-block"},[e("pre",null,`{
  "success": true,
  "message": "Word文档生成成功",
  "data": {
    "fileId": "模板文件ID",
    "templateName": "模板名称",
    "outputPath": "生成文档路径",
    "buildTime": "2024-01-01T12:00:00.000Z",
    "success": true
  }
}`)])],-1))])]),_:1},8,["modelValue"])])}}}),Ae=ee(Se,[["__scopeId","data-v-499d741b"]]);export{Ae as default};
