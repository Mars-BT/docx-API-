import{d as Q,u as X,r as h,p as Z,o as ee,E as b,b as d,e as s,f as l,g,t as m,w as n,h as u,F,i as te,k as p,l as I,q as le,s as ae,x as se,j as i,y as oe,_ as ne}from"./index-DgJpEOly.js";import{g as re,a as ue,s as ie}from"./api-BUDIlLK6.js";const de={class:"templates-settings-view"},pe={class:"main-container"},me={class:"template-header"},ve={class:"template-info"},ce={key:0,class:"template-details"},_e={class:"detail-item"},fe={class:"value"},ge={class:"detail-item"},ye={class:"value"},xe={class:"detail-item"},he={class:"value"},be={class:"rules-section"},Ve={class:"section-header"},ke={key:0,class:"rules-list"},we={class:"rule-header"},Ce={class:"rule-name"},Te={class:"rule-type"},Oe={class:"rule-actions"},We={class:"rule-details"},Ne={class:"detail-row"},Re={class:"value"},Ee={key:0,class:"detail-row"},Se={class:"value"},Fe={key:1,class:"detail-row"},Ie={class:"value"},Be={key:2,class:"detail-row"},Ue={class:"value"},je={key:1,class:"empty-rules"},qe={key:0,class:"footer-actions"},Me={class:"dialog-footer"},$e=Q({__name:"TemplatesSettingsView",setup(Je){const w=X(),V=h(),r=h([]),_=h(!1),v=h(-1),C=h(!1),t=Z({varname:"",type:"excel",sheetname:"",vOrW:!0,path:"",format:"original"}),B={varname:[{required:!0,message:"请输入变量名",trigger:"blur"},{validator:U,trigger:"blur"}],type:[{required:!0,message:"请选择数据类型",trigger:"change"}],sheetname:[{required:!0,message:"请输入工作表名",trigger:"blur"}],path:[{required:!0,message:"请输入JSON路径",trigger:"blur"}],format:[{required:!0,message:"请选择格式化方法",trigger:"change"}]},k=h();function U(a,e,y){if(!e){y();return}r.value.findIndex((T,O)=>T.varname===e&&O!==v.value)!==-1?y(new Error("变量名已存在，请使用其他名称")):y()}ee(()=>{j(),q()});const j=async()=>{try{const a=await re(w.templateId);V.value=a}catch(a){b.error("获取模板信息失败"),console.error(a)}},q=async()=>{try{const a=await ue(w.templateId);r.value=a.rules||[]}catch{console.log("暂无已配置的规则"),r.value=[]}},M=a=>new Date(a).toLocaleDateString("zh-CN"),$=a=>({excel:"Excel数据",json:"JSON数据",direct:"直接赋值"})[a]||a,J=a=>({original:"原始值",formatToChineseNumber:"转千位符",formatToWanYuan:"转成万元",formatToFixed2:"保留2位小数"})[a]||a,D=()=>{t.sheetname="",t.vOrW=!0,t.path=""},R=()=>{t.varname="",t.type="excel",t.sheetname="",t.vOrW=!0,t.path="",t.format="original",v.value=-1,k.value&&k.value.clearValidate()},z=a=>{const e=r.value[a];v.value=a,t.varname=e.varname,t.type=e.type,t.format=e.format,e.type==="excel"&&e.rules&&(t.sheetname=e.rules.sheetname||"",t.vOrW=e.rules.vOrW!==void 0?e.rules.vOrW:!0),e.type==="json"&&e.rules&&(t.path=e.rules.path||""),_.value=!0},A=async a=>{try{await oe.confirm(`确定要删除变量"${r.value[a].varname}"的规则吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.value.splice(a,1),b.success("删除成功")}catch{}},L=async()=>{if(k.value)try{await k.value.validate();const a={varname:t.varname,type:t.type,format:t.format};t.type==="excel"?a.rules={sheetname:t.sheetname,vOrW:t.vOrW}:t.type==="json"&&(a.rules={path:t.path}),v.value===-1?r.value.push(a):r.value[v.value]=a,_.value=!1,R(),b.success(v.value===-1?"添加成功":"修改成功")}catch(a){console.error("表单验证失败:",a)}},Y=async()=>{if(r.value.length===0){b.warning("请至少添加一个规则");return}C.value=!0;try{await ie(w.templateId,r.value),b.success("保存成功！")}catch(a){b.error("保存失败："+a.message),console.error(a)}finally{C.value=!1}};return(a,e)=>{const y=u("el-icon"),c=u("el-button"),T=u("el-tag"),O=u("el-empty"),W=u("el-input"),x=u("el-form-item"),f=u("el-option"),E=u("el-select"),S=u("el-radio"),G=u("el-radio-group"),H=u("el-form"),K=u("el-dialog");return i(),d("div",de,[s("div",pe,[s("div",me,[s("div",ve,[e[13]||(e[13]=s("h1",{class:"title"},"模板变量规则配置",-1)),V.value?(i(),d("div",ce,[s("div",_e,[e[10]||(e[10]=s("span",{class:"label"},"模板名称：",-1)),s("span",fe,m(V.value.templateName),1)]),s("div",ge,[e[11]||(e[11]=s("span",{class:"label"},"模板分类：",-1)),s("span",ye,m(V.value.templateCategory),1)]),s("div",xe,[e[12]||(e[12]=s("span",{class:"label"},"上传时间：",-1)),s("span",he,m(M(V.value.uploadTime)),1)])])):g("",!0)])]),s("div",be,[s("div",Ve,[e[15]||(e[15]=s("h2",null,"已配置规则",-1)),l(c,{type:"primary",onClick:e[0]||(e[0]=o=>_.value=!0)},{default:n(()=>[l(y,null,{default:n(()=>[l(I(le))]),_:1}),e[14]||(e[14]=p(" 添加新规则 "))]),_:1,__:[14]})]),r.value.length>0?(i(),d("div",ke,[(i(!0),d(F,null,te(r.value,(o,N)=>(i(),d("div",{class:"rule-item",key:N},[s("div",we,[s("div",Ce,[l(T,null,{default:n(()=>[p(m($(o.type)),1)]),_:2},1024),s("span",Te,m(o.varname),1)]),s("div",Oe,[l(c,{onClick:P=>z(N)},{default:n(()=>e[16]||(e[16]=[p("编辑")])),_:2,__:[16]},1032,["onClick"]),l(c,{onClick:P=>A(N),style:{color:"#f56c6c"}},{default:n(()=>e[17]||(e[17]=[p("删除")])),_:2,__:[17]},1032,["onClick"])])]),s("div",We,[s("div",Ne,[e[18]||(e[18]=s("span",{class:"label"},"格式化方法：",-1)),s("span",Re,m(J(o.format)),1)]),o.type==="excel"&&o.rules?(i(),d("div",Ee,[e[19]||(e[19]=s("span",{class:"label"},"工作表名：",-1)),s("span",Se,m(o.rules.sheetname),1)])):g("",!0),o.type==="excel"&&o.rules?(i(),d("div",Fe,[e[20]||(e[20]=s("span",{class:"label"},"输出类型：",-1)),s("span",Ie,m(o.rules.vOrW?"格式化后的值":"原始值"),1)])):g("",!0),o.type==="json"&&o.rules?(i(),d("div",Be,[e[21]||(e[21]=s("span",{class:"label"},"JSON路径：",-1)),s("span",Ue,m(o.rules.path),1)])):g("",!0)])]))),128))])):(i(),d("div",je,[l(O,{description:"暂无配置规则"},{default:n(()=>[l(c,{type:"primary",onClick:e[1]||(e[1]=o=>_.value=!0)},{default:n(()=>e[22]||(e[22]=[p("添加第一个规则")])),_:1,__:[22]})]),_:1})]))]),r.value.length>0?(i(),d("div",qe,[l(c,{type:"success",size:"large",onClick:Y,loading:C.value},{default:n(()=>[l(y,null,{default:n(()=>[l(I(ae))]),_:1}),e[23]||(e[23]=p(" 保存所有规则 "))]),_:1,__:[23]},8,["loading"])])):g("",!0)]),l(K,{modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=o=>_.value=o),title:v.value===-1?"添加新规则":"编辑规则",width:"600px",onClose:R},{footer:n(()=>[s("span",Me,[l(c,{onClick:e[8]||(e[8]=o=>_.value=!1)},{default:n(()=>e[26]||(e[26]=[p("取消")])),_:1,__:[26]}),l(c,{type:"primary",onClick:L},{default:n(()=>e[27]||(e[27]=[p("确定")])),_:1,__:[27]})])]),default:n(()=>[l(H,{model:t,rules:B,ref_key:"ruleFormRef",ref:k,"label-width":"120px"},{default:n(()=>[l(x,{label:"变量名",prop:"varname"},{default:n(()=>[l(W,{modelValue:t.varname,"onUpdate:modelValue":e[2]||(e[2]=o=>t.varname=o),placeholder:"请输入变量名（不可重复）",disabled:v.value!==-1},null,8,["modelValue","disabled"])]),_:1}),l(x,{label:"数据类型",prop:"type"},{default:n(()=>[l(E,{modelValue:t.type,"onUpdate:modelValue":e[3]||(e[3]=o=>t.type=o),placeholder:"请选择数据类型",onChange:D},{default:n(()=>[l(f,{label:"Excel数据",value:"excel"}),l(f,{label:"JSON数据",value:"json"}),l(f,{label:"直接赋值",value:"direct"})]),_:1},8,["modelValue"])]),_:1}),t.type==="excel"?(i(),d(F,{key:0},[l(x,{label:"工作表名",prop:"sheetname"},{default:n(()=>[l(W,{modelValue:t.sheetname,"onUpdate:modelValue":e[4]||(e[4]=o=>t.sheetname=o),placeholder:"请输入Excel工作表名称"},null,8,["modelValue"])]),_:1}),l(x,{label:"输出类型",prop:"vOrW"},{default:n(()=>[l(G,{modelValue:t.vOrW,"onUpdate:modelValue":e[5]||(e[5]=o=>t.vOrW=o)},{default:n(()=>[l(S,{value:!0},{default:n(()=>e[24]||(e[24]=[p("Excel格式化后的值")])),_:1,__:[24]}),l(S,{value:!1},{default:n(()=>e[25]||(e[25]=[p("Excel原始值")])),_:1,__:[25]})]),_:1},8,["modelValue"])]),_:1})],64)):g("",!0),t.type==="json"?(i(),se(x,{key:1,label:"JSON路径",prop:"path"},{default:n(()=>[l(W,{modelValue:t.path,"onUpdate:modelValue":e[6]||(e[6]=o=>t.path=o),placeholder:"例如：数据[0].数据A",type:"textarea",rows:2},null,8,["modelValue"])]),_:1})):g("",!0),l(x,{label:"格式化方法",prop:"format"},{default:n(()=>[l(E,{modelValue:t.format,"onUpdate:modelValue":e[7]||(e[7]=o=>t.format=o),placeholder:"请选择格式化方法"},{default:n(()=>[l(f,{label:"原始值",value:"original"}),l(f,{label:"转千位符",value:"formatToChineseNumber"}),l(f,{label:"转成万元",value:"formatToWanYuan"}),l(f,{label:"保留2位小数",value:"formatToFixed2"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Ae=ne($e,[["__scopeId","data-v-89e70fb9"]]);export{Ae as default};
